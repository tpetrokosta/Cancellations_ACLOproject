---
title: "Cancellations visualizations"
output:
  pdf_document: default
  html_document: default
date: "2025-12-12"
---
Figure 1.1: ACLO Group Lesson Cancellations – Monthly totals from September 2024 to January 2025:
```{r}
library(ggplot2)

month_data <- read.csv("C:/Users/chant/OneDrive/month_sept_jan.csv", stringsAsFactors = FALSE)

month_data <- month_data[!is.na(month_data$Month), ]

month_data <- month_data[month_data$Value > 0, ]

month_data$Date <- as.Date(paste(month_data$Year, month_data$Month, "01", sep = "-"), format="%Y-%b-%d")

head(month_data)

ggplot(month_data, aes(x = Date, y = Value)) +
  geom_col(fill = "salmon", width = 15) + 
  labs(
    title = "ACLO group lesson cancellations",
    subtitle = "Monthly cancellations for group lessons (Sep 2024 – Jan 2025)",
    x = "Month",
    y = "Number of Cancellations"
  ) +
  scale_x_date(
    date_labels = "%b %Y",
    date_breaks = "1 month"
  ) +
  scale_y_continuous(
    limits = c(0, 12500),
    breaks = seq(0, 12500, by = 2500)
  ) +
  theme_light() +
  theme(
    plot.title = element_text(face = "bold", size = 16, hjust = 0.5),
    plot.subtitle = element_text(size = 12, hjust = 0.5),
    axis.text.x = element_text(angle = 45, hjust = 1, color = "black"),
    axis.text.y = element_text(color = "black"),
    axis.title = element_text(face = "bold")
  )

```

Figure 1.2: ACLO Group Lesson Cancellations – Monthly totals from February 2025 to August 2025:
```{r}
library(ggplot2)
month_data <- read.csv("C:/Users/chant/OneDrive/month_feb_aug.csv", stringsAsFactors = FALSE)
month_data <- month_data[!is.na(month_data$Month), ]
month_data <- month_data[month_data$Value > 0, ]
month_data$Date <- as.Date(paste(month_data$Year, month_data$Month, "01", sep = "-"), format="%Y-%b-%d")
head(month_data)
ggplot(month_data, aes(x = Date, y = Value)) +
  geom_col(fill = "salmon", width = 15) + 
  labs(
    title = "ACLO group lesson cancellations",
    subtitle = "Monthly cancellations for group lessons (Feb 2025 – Aug 2025)",
    x = "Month",
    y = "Number of Cancellations"
  ) +
  scale_x_date(
    date_labels = "%b %Y",
    date_breaks = "1 month"
  ) +
  scale_y_continuous(
    limits = c(0, 12500),
    breaks = seq(0, 12500, by = 2500)
  ) +
  theme_light() +
  theme(
    plot.title = element_text(face = "bold", size = 16, hjust = 0.5),
    plot.subtitle = element_text(size = 12, hjust = 0.5),
    axis.text.x = element_text(angle = 45, hjust = 1, color = "black"),
    axis.text.y = element_text(color = "black"),
    axis.title = element_text(face = "bold")
  )
```

Figure 1.3: Monthly Bookings and Cancellations for Group Lessons (Sep 2024–Jan 2025):
```{r}
library(ggplot2)
library(dplyr)

ACLO_bezetting_vs_cancellations_sep_till_jan$Month <- as.character(
  ACLO_bezetting_vs_cancellations_sep_till_jan$Month
)

ACLO_bezetting_vs_cancellations_sep_till_jan$Month <- factor(
  ACLO_bezetting_vs_cancellations_sep_till_jan$Month,
  levels = c("Sep", "Oct", "Nov", "Dec", "Jan")
)

levels(ACLO_bezetting_vs_cancellations_sep_till_jan$Month) <- c(
  "Sep 2024", "Oct 2024", "Nov 2024", "Dec 2024", "Jan 2025"
)

ggplot(ACLO_bezetting_vs_cancellations_sep_till_jan, 
       aes(x = Month, y = Count, fill = Type)) +
  geom_bar(
    stat = "identity", 
    position = position_dodge2(width = 0.9, padding = -0.3),
    width = 0.7
  ) +
  labs(
    title = "Monthly Bookings and Cancellations for Group Lessons",
    subtitle = "September 2024 – January 2025",
    x = "Month",
    y = "Number of Group Lessons",
    fill = "Type"
  ) +
  scale_fill_manual(
    values = c("Total bookings" = "lightsteelblue", "Cancelled" = "salmon"),
    labels = c("Cancellations", "Total Bookings")
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(
      face = "bold",
      size = 16,
      hjust = 0.5
    ),
    plot.subtitle = element_text(
      face = "plain",
      size = 12,
      hjust = 0.5
    ),
    axis.text.x = element_text(angle = 45, hjust = 1)
  )

```

Figure 1.4: Monthly Bookings and Cancellations for Group Lessons (Feb 2025–Aug 2025):
```{r}
library(ggplot2)
library(dplyr)

aclo_bezetting_vs_cancellations_feb_till_aug$Month <- as.character(
  aclo_bezetting_vs_cancellations_feb_till_aug$Month
)

aclo_bezetting_vs_cancellations_feb_till_aug$Month <- factor(
  aclo_bezetting_vs_cancellations_feb_till_aug$Month,
  levels = c("Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug")
)

levels(aclo_bezetting_vs_cancellations_feb_till_aug$Month) <- c(
  "Feb 2025", "Mar 2025", "Apr 2025", "May 2025", "Jun 2025", "Jul 2025", "Aug 2025"
)

ggplot(aclo_bezetting_vs_cancellations_feb_till_aug, 
       aes(x = Month, y = Count, fill = Type)) +
  geom_bar(
    stat = "identity", 
    position = position_dodge2(width = 0.9, padding = -0.3),
    width = 0.7
  ) +
  labs(
    title = "Monthly Bookings and Cancellations for Group Lessons",
    subtitle = "February 2025 – August 2025",
    x = "Month",
    y = "Number of Group Lessons",
    fill = "Type"
  ) +
  scale_fill_manual(
    values = c("Total bookings" = "lightsteelblue", "Cancelled" = "salmon"),
    labels = c("Cancellations", "Total Bookings")
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(
      face = "bold",
      size = 16,
      hjust = 0.5
    ),
    plot.subtitle = element_text(
      face = "plain",
      size = 12,
      hjust = 0.5
    ),
    axis.text.x = element_text(angle = 45, hjust = 1)
  )

```

Figure 1.5: ACLO Course Period Cancellations – Sub-periods 1A through 4B
```{r}
cancellations <- c(277, 204, 222, 248, 258, 207, 291, 219)

subperiods <- c("1A","1B","2A","2B","3A",
            "3B","4A","4B")
 
par(mgp = c(2.7, 0.7, 0))

# Bar plot 
barplot(cancellations,
        names.arg = subperiods,
        col = "#4197D9",
        main = "ACLO Course Period Cancellations",
        xlab = "Sub-period",
        ylab = "Number of Cancellations",
        font.lab = 2,
        ylim=c(0,300),
        las = 1,
       )
 
mtext("Number of cancellations per sub-period",
      side = 3,     
      line = 0.5,    
      cex = 0.9)
```

Figure 1.6: ACLO Course Period Cancellations – Sep 2024-Aug 2025
```{r}
cancellations <- c(260, 212, 220, 70, 181, 245, 207, 233, 131, 159, 1, 7)

months <- c("Sep","Oct","Nov","Dec","Jan",
            "Feb","Mar","Apr","May","Jun","Jul","Aug")
 
par(mgp = c(2.7, 0.7, 0))

# Bar plot
barplot(cancellations,
        names.arg = months,
        col = "lightblue",
        main = "ACLO Course Period Cancellations",
        xlab = "Month",
        ylab = "Number of Cancellations",
        font.lab = 2,
        ylim=c(0,300),
        las = 2,
       )
#subtitle
mtext("Number of cancellations per month",
      side = 3,     
      line = 0.5,    
      cex = 0.9)
```

Figure 1.7: Density of hours between booking and cancellation – Sep 2024-Aug 2025
```{r}
library(lubridate)
library(readxl)
library(dplyr)

data <- read_excel(
  "C:/BSc Maths Year 3/Minor Data Science/ACLO project/ACLO groepsles annuleringen 1 sep 2024 tot 31 jan 2025.xlsx",
  sheet = 1,
  range = "A2:A49789",
  col_names = FALSE
)

data_2 <- read_excel(
  "C:/BSc Maths Year 3/Minor Data Science/ACLO project/ACLO groepsles annuleringen 1 feb 2025 tot 31 aug 2025.xlsx",
  sheet = 1,
  range = "A2:A49666",
  col_names = FALSE
)

colnames(data) <- "cancellation_time"
colnames(data_2) <- "cancellation_time_2"


# Convert to POSIXct if not already
data$cancellation_time <- as.POSIXct(data$cancellation_time, origin = "1899-12-30")
data_2$cancellation_time_2 <- as.POSIXct(data_2$cancellation_time_2, origin = "1899-12-30")

# Extract hours, minutes, seconds
hours   <- hour(data$cancellation_time)
minutes <- minute(data$cancellation_time)
seconds <- second(data$cancellation_time)

hours_2   <- hour(data_2$cancellation_time_2)
minutes_2 <- minute(data_2$cancellation_time_2)
seconds_2 <- second(data_2$cancellation_time_2)

total_hours <- hours + minutes / 60 + seconds / 3600
total_hours_2 <- hours_2 + minutes_2 / 60 + seconds_2 / 3600

clean_hours <- total_hours[!is.na(total_hours)]
clean_hours_2 <- total_hours_2[!is.na(total_hours_2)]

d1 <- density(clean_hours)
d2 <- density(clean_hours_2)

plot(d1,
     col = "blue",
     main = "Density of Cancellation Times",
     xlab = "Hours between booking and cancellation")

lines(d2, col = "red")

legend("topright",
       legend = c("Sep 2024 – Jan 2025", "Feb 2025 – Aug 2025"),
       col = c("blue", "red"),
       lty = 1,
       bty = "n"
       )
df <- read_excel(
  "C:/BSc Maths Year 3/Minor Data Science/ACLO project/ACLO groepsles annuleringen 1 feb 2025 tot 31 aug 2025.xlsx",
  sheet = 1,
  range = "A2:C49666",
  col_names = c(
    "time_between",
    "omschrijving",
    "cancel_time"
  )
)

```


Table 1.4: Summary of density of cancellation times (Sep 2024 – Aug 2025)
```{r}
mode_period1 <- d1$x[which.max(d1$y)]
mode_period2 <- d2$x[which.max(d2$y)]
summary_stats <- rbind(
  Period1 = c(
    mean   = mean(clean_hours),
    median = median(clean_hours),
    mode   = mode_period1,
    q25    = quantile(clean_hours, 0.25),
    q75    = quantile(clean_hours, 0.75)
  ),
  Period2 = c(
    mean   = mean(clean_hours_2),
    median = median(clean_hours_2),
    mode   = mode_period2,
    q25    = quantile(clean_hours_2, 0.25),
    q75    = quantile(clean_hours_2, 0.75)
  )
)

round(summary_stats, 2)
```


